
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <title>Flot Examples: Real-time updates</title>
        <link href="examples.css" rel="stylesheet" type="text/css">
        <!--[if lte IE 8]><script language="javascript" type="text/javascript" src="JS/excanvas.min.js"></script><![endif]-->
        <script type="text/javascript" src="JS/jquery.js"></script>
        <script type="text/javascript" src="JS/jquery.flot.js"></script>
        <script type="text/javascript">

            parent.top.$('#runOneStepInScenario, #runFullScenario, #runFullTime').click(function(event) {
                // data source fetched from the server

                var data1 = [], data2 = [], data3 = [], data4 = [], data5 = [];
                var data = new Array([]);
                var totalPoints = 300;
                var countRow = 0;


                function getRandomData1() {

                    if (data1.length > 0)
                        data1 = data1.slice(1);

                    // Do a random walk

                    while (data1.length < totalPoints) {

                        var prev = data1.length > 0 ? data1[data1.length - 1] : 50,
                                y = prev + Math.random() * 10 - 5;

                        if (y < 0) {
                            y = 0;
                        } else if (y > 100) {
                            y = 100;
                        }

                        data1.push(y);
                    }

                    // Zip the generated y values with the x values

                    var res = [];
                    for (var i = 0; i < data1.length; ++i) {
                        res.push([i, data1[i]]);
                    }

                    return res;
                }

                function getData() {
                    var request = new XMLHttpRequest();
                    request.open('GET', '/Simulator/SimServlet?request=getChartStatistics', false);
                    request.send(null);
                    if (request.status === 200) {

                        var tags = $.parseJSON(request.responseText);

                        alert("request.responseText: " + request.responseText);
                        alert("tags: " + tags);

                        var countColumn = 0;

                        // init only first for checking
                        if (!data[0]) {
                            data[0] = new Array();
                        }


                        // cut one so we can add new one for the running chart
                        if (data[0].length >= totalPoints) {
//                            for (var i = 0; i < tags[headline].length; i++) {
//                                data[i] = data[i].slice(1);
//                            }
                            return;
                        }

                        countColumn = 0;
                        for (var headline in tags) {

                            alert("tags[headline].length: " + tags[headline].length);
                            for (var i = 0; i < tags[headline].length; i++) {

                                //if (needInit) {
                                //data.push([]);
                                //}
                                //alert("inserting: " + tags[headline][i]);
                                //alert("to: " + data[countColumn]);

                                if (!data[countColumn]) {
                                    data[countColumn] = new Array([]);
                                    //alert("to2: " + data[countColumn]);
                                }

                                data[countColumn].push([countRow, tags[headline][i]]);
                                alert("inserting to data[" + countColumn + "] = [" + countRow + "," + tags[headline][i] + "]");

                                countColumn++;
                            }
                        }
                        countRow++;

                        // debug
                        var k = 0;
                        for (var headline in tags) {
                            alert(k + ": " + data[k]);
                            k++;
                        }


                        //data = data.replace("[", "");

                        //for (var i = 0; i < data2.length; ++i) {
                        //    res.push([i, data2[i]]);
                        // }
                    }
                }

                // Set up the control widget

                var updateInterval = 30;
                $("#updateInterval").val(updateInterval).change(function() {
                    var v = $(this).val();
                    if (v && !isNaN(+v)) {
                        updateInterval = +v;
                        if (updateInterval < 1) {
                            updateInterval = 1;
                        } else if (updateInterval > 2000) {
                            updateInterval = 2000;
                        }
                        $(this).val("" + updateInterval);
                    }
                });

                var plot = $.plot("#placeholder", [{data: data[1], label: "1"}, {data: data[2], label: "2"}], {
                    series: {
                        shadowSize: 0	// Drawing is faster without shadows
                    },
                    yaxis: {
                        min: 0,
                        max: 100
                    },
                    xaxis: {
                        show: false
                    }
                });

                function update() {
                    getData();
                    plot.setData([{data: data[1], label: "1"}, {data: data[2], label: "2"}]);

                    // Since the axes don't change, we don't need to call plot.setupGrid()
                    plot.draw();
                    setTimeout(update, updateInterval);
                }

                update();
            });

        </script>
    </head>
    <body>

        <div id="content">
            <div class="demo-container">
                <div id="placeholder" class="demo-placeholder"></div>
            </div>
        </div>

    </body>
</html>
