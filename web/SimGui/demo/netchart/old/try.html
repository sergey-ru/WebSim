<!DOCTYPE html>
<html>
    <head>
    </head>
    <body>
        <canvas id="canvas" width=800 height=600></canvas>

        <script>

            var canvas = document.getElementById('canvas');

            // Grab our context
            var context = canvas.getContext('2d');

            // Make sure we have a valid defintion of requestAnimationFrame
            var requestAnimationFrame =
                    window.requestAnimationFrame ||
                    window.webkitRequestAnimationFrame ||
                    window.mozRequestAnimationFrame ||
                    window.msRequestAnimationFrame ||
                    window.oRequestAnimationFrame ||
                    function(callback) {
                        return setTimeout(callback, 16);
                    };


            var animate = function(square, prop, val, duration) {
                // The calculations required for the step function
                var start = new Date().getTime();
                var end = start + duration;
                var current = square[prop];
                var distance = val - current;

                var step = function() {
                    // Get our current progres
                    var timestamp = new Date().getTime();
                    var progress = Math.min((duration - (end - timestamp)) / duration, 1);

                    alert("current:"+current);
                    alert("distance"+distance);
                    alert("progress"+progress);

                    // Update the square's property
                    square[prop] = current + (distance * progress);
                    render();

                    // If the animation hasn't finished, repeat the step.
                    if (progress < 1)
                        requestAnimationFrame(step);
                };

                var render = function() {
                    // Clear the canvas
                    context.clearRect(0, 0, canvas.width, canvas.height);

                    // Draw the square
                    context.beginPath();
                    context.rect(square.x, square.y, square.width, square.height);
                    context.fillStyle = square.fill;
                    context.fill();

                    // Redraw
                    requestAnimationFrame(render);
                };

                // Start the animation
                return step();
            };

            var MessagePath = function(fromPos, toArr) {
                var messageObj = {
                    'x': fromPos[0],
                    'y': fromPos[1],
                    'width': 10,
                    'height': 10,
                    'fill': '#000000'
                };

                function runner(i) {
                    //function1();
                    animate(messageObj, 'x', toArr[i][0], 1000);
                    animate(messageObj, 'y', toArr[i][1], 1000);
                    
                    if (i == toArr.length) return;
                    
                    
                    setTimeout(function() {
                        runner(i+1);
                    }, 1000);
                }

                runner(0);
                
            };

            // call animation
            MessagePath([0, 0], [[300, 300], [300, 10], [600,600], [0,0]]);
            MessagePath([10, 10], [[123, 400], [30, 600], [600,200], [30,0]]);

        </script>
    </body>
</html>